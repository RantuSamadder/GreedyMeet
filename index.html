<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Free Time Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; margin: 20px; }
form { margin-bottom: 30px; }
input, select { padding: 5px; margin: 5px; }
</style>
</head>
<body>

<h2>Submit Your Schedule</h2>
<form id="scheduleForm">
  <input type="text" id="studentID" placeholder="Student ID" required>
  <select id="day">
    <option>Saturday</option>
    <option>Sunday</option>
    <option>Monday</option>
    <option>Tuesday</option>
    <option>Wednesday</option>
    <option>Thursday</option>
    <option>Friday</option>
  </select>
  <select id="timeSlot">
    <option>08:30–09:50</option>
    <option>08:00–10:00</option>
    <option>08:30–10:00</option>
    <option>09:00–10:00</option>
    <option>10:00–11:20</option>
    <option>10:00–12:00</option>
    <option>11:30–12:50</option>
    <option>11:30–13:30</option>
    <option>13:30–14:50</option>
    <option>13:30–15:30</option>
    <option>15:00–16:20</option>
    <option>15:00–17:00</option>
    <option>16:30–18:30</option>
    <option>16:30–17:50</option>
    <option>17:00–19:00</option>
  </select>
  <button type="submit">Submit</button>
</form>

<h2>Group Free Time Dashboard</h2>
<select id="daySelect">
  <option>Saturday</option>
  <option>Sunday</option>
  <option>Monday</option>
  <option>Tuesday</option>
  <option>Wednesday</option>
  <option>Thursday</option>
  <option>Friday</option>
</select>

<canvas id="freeTimeChart" width="800" height="400"></canvas>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPffdSfOG0wjVM8HBg-ze1ooT3Qk0FcFDDP8HJlOv43I9HKOa38ZpPP7hF8DdpUJpg/exec";

document.getElementById("scheduleForm").addEventListener("submit", function(e){
  e.preventDefault();
  const data = {
    studentID: document.getElementById("studentID").value,
    day: document.getElementById("day").value,
    timeSlot: document.getElementById("timeSlot").value
  };
  fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(data)
  }).then(res => res.json())
    .then(res => alert("Schedule submitted!"));
});

const ctx = document.getElementById('freeTimeChart').getContext('2d');
let chart;

function loadChart(day){
  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(data => {
      const slots = Object.keys(data[day]);
      const percentages = Object.values(data[day]);

      if(chart) chart.destroy();

      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: slots,
          datasets: [{
            label: 'Free %',
            data: percentages,
            backgroundColor: percentages.map(p => `rgba(75, 192, 192, ${p/100 + 0.2})`),
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true, max: 100, title: { display: true, text: '% Students Free' } },
            x: { title: { display: true, text: 'Time Slot' } }
          }
        }
      });
    });
}

document.getElementById("daySelect").addEventListener("change", function(){
  loadChart(this.value);
});

// Initial chart
loadChart(document.getElementById("daySelect").value);
</script>

</body>
</html>
