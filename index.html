<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GreedyMeet</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* CORE STYLES */
body {
  margin: 0;
  font-family: 'Courier New', monospace;
  background: #03040a;
  color: #00ffe0;
  overflow-x: hidden; /* Prevent horizontal scroll on mobile */
}

/* Binary background animation */
@keyframes floatBits {
  from { transform: translateY(0); opacity: .5; }
  to { transform: translateY(-120vh); opacity: .8; }
}
.binary {
  position: fixed;
  bottom: -10vh;
  font-size: 11px;
  color: rgba(0,255,200,.25);
  animation: floatBits linear infinite;
  pointer-events: none;
  z-index: -1;
}

/* MAIN CONTAINER */
.card {
  background: rgba(0,255,200,.07);
  border: 1px solid #00ffc8;
  border-radius: 14px;
  padding: 20px;
  margin: 20px auto;
  max-width: 1100px;
  width: 90%; /* Responsive width */
  box-shadow: 0 0 16px #00ffc825;
}

/* INPUTS & BUTTONS */
input, select, button {
  padding: 12px;
  margin: 6px 0;
  border-radius: 6px;
  border: 1px solid #00ffc8;
  background: #081616;
  color: #00ffe0;
  box-sizing: border-box; /* Ensures padding doesn't break width */
  width: 100%;
  font-family: inherit;
}

button {
  cursor: pointer;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 1px;
  transition: background 0.3s;
}
button:hover { background: #003737; }

/* SPINNER */
.spinner {
  display: none;
  width: 14px;
  height: 14px;
  border: 3px solid #00ffc844;
  border-top: 3px solid #00ffc8;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  vertical-align: middle;
  margin-left: 8px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* --- FLEX LAYOUT (Responsive) --- */
.flex {
  display: flex;
  gap: 24px;
}

/* Desktop: Side by Side */
@media (min-width: 768px) {
  .left, .right { flex: 1; }
  /* Ensure chart container has height context */
  .right { display: flex; align-items: center; } 
}

/* Mobile: Stacked Vertical */
@media (max-width: 767px) {
  .flex { flex-direction: column; }
  .left, .right { width: 100%; }
  
  /* Add spacing between the Find section and the Chart */
  .right {
    margin-top: 20px; 
    border-top: 1px solid #00ffc833; 
    padding-top: 20px;
    min-height: 300px; /* Ensure chart area isn't too small */
  }
}

/* --- UPDATED DROPDOWN STYLING --- */
.dropdown-content {
  display: none;
  background: #081818;
  border: 1px solid #00ffc8;
  padding: 8px;
  max-height: 250px;
  overflow-y: auto;
  margin-top: -5px;
  margin-bottom: 10px;
  border-radius: 0 0 6px 6px;
}

/* Specific styling for the Checkbox Labels (New lines, Compact, Aligned) */
.dropdown-content label {
  display: flex;          /* Flexbox for alignment */
  align-items: center;    /* Vertically center text with box */
  padding: 6px 8px;       /* Compact padding */
  cursor: pointer;
  border-radius: 4px;
  transition: background 0.2s;
}

.dropdown-content label:hover {
  background: rgba(0, 255, 200, 0.15);
}

/* Custom checkbox spacing */
.dropdown-content input[type="checkbox"] {
  width: 16px;
  height: 16px;
  margin: 0 12px 0 0; /* Margin-right pushes text away slightly */
  cursor: pointer;
  accent-color: #00ffc8; /* Colors the checkmark */
}

/* OFF DAY ROW */
.offday-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin: 8px 0;
  background: #001f1f;
  padding: 8px;
  border-radius: 6px;
}
.offday-row input {
  width: 20px;
  margin: 0;
}

/* HIGHLIGHT BOXES */
.highlight {
  background: #001f1f;
  padding: 10px;
  border-left: 4px solid #00ffc8;
  margin: 8px 0;
  font-size: 0.9em;
}

.toggle-btn {
  background: #002828;
  margin-bottom: 12px;
  border: 1px dashed #00ffc8;
}

/* FOOTER */
footer {
  text-align: center;
  padding: 20px;
  margin-top: 20px;
  font-size: 13px;
  color: #00ffc8;
  opacity: .7;
  border-top: 1px solid #00ffc833;
}
</style>
</head>

<body>

<script>
for(let i=0;i<80;i++){
  const b=document.createElement("div");
  b.className="binary";
  b.style.left=Math.random()*100+"vw";
  b.style.animationDuration=(6+Math.random()*12)+"s";
  b.textContent=Math.random()>.5?"0":"1";
  document.body.appendChild(b);
}
</script>

<div class="card">
  <h2 style="text-align:center; margin-bottom:20px;">üìä GreedyMeet</h2>

  <div class="flex">

    <div class="left">

      <button class="toggle-btn" onclick="toggleForm()">‚ûï Submit Your Class Schedule</button>

      <form id="scheduleForm" style="display:none">
        <input id="studentID" placeholder="Student ID" required>
        <input id="group" placeholder="Group Name" required>

        <select id="day">
          <option>Saturday</option><option>Sunday</option><option>Monday</option>
          <option>Tuesday</option><option>Wednesday</option>
          <option>Thursday</option><option>Friday</option>
        </select>

        <div class="offday-row">
          <input type="checkbox" id="offDay">
          <label for="offDay" style="cursor:pointer">Mark as OFF day (No Class)</label>
        </div>

        <div id="slotBox">
          <button type="button" onclick="toggleSlots()">Select Time Slots ‚ñº</button>
          <div class="dropdown-content" id="slotDropdown">
            <label><input type="checkbox" value="08:00‚Äì10:00"> 08:00‚Äì10:00</label>
            <label><input type="checkbox" value="08:30‚Äì09:50"> 08:30‚Äì09:50</label>
            <label><input type="checkbox" value="08:30‚Äì10:00"> 08:30‚Äì10:00</label>
            <label><input type="checkbox" value="09:00‚Äì10:00"> 09:00‚Äì10:00</label>
            <label><input type="checkbox" value="10:00‚Äì11:20"> 10:00‚Äì11:20</label>
            <label><input type="checkbox" value="10:00‚Äì12:00"> 10:00‚Äì12:00</label>
            <label><input type="checkbox" value="11:30‚Äì12:50"> 11:30‚Äì12:50</label>
            <label><input type="checkbox" value="11:30‚Äì13:30"> 11:30‚Äì13:30</label>
            <label><input type="checkbox" value="13:30‚Äì14:50"> 13:30‚Äì14:50</label>
            <label><input type="checkbox" value="13:30‚Äì15:30"> 13:30‚Äì15:30</label>
            <label><input type="checkbox" value="15:00‚Äì16:20"> 15:00‚Äì16:20</label>
            <label><input type="checkbox" value="15:00‚Äì17:00"> 15:00‚Äì17:00</label>
            <label><input type="checkbox" value="16:30‚Äì17:50"> 16:30‚Äì17:50</label>
            <label><input type="checkbox" value="16:30‚Äì18:30"> 16:30‚Äì18:30</label>
            <label><input type="checkbox" value="17:00‚Äì19:00"> 17:00‚Äì19:00</label>
          </div>
        </div>

        <button type="submit" style="background:#005544; border-color:#00ffc8;">Submit Data</button>
      </form>

      <hr style="border-color:#00ffc833; margin: 20px 0;">

      <h3 style="margin-top:0">üîç Find Optimal Slot</h3>
      
      <input id="dashboardGroup" placeholder="Enter Group Name to Search">

      <select id="daySelect">
        <option>Saturday</option><option>Sunday</option><option>Monday</option>
        <option>Tuesday</option><option>Wednesday</option>
        <option>Thursday</option><option>Friday</option>
      </select>

      <button onclick="loadChart()">
        üîç Find Availability
        <span class="spinner" id="loader"></span>
      </button>

      <p style="margin-top:15px">Total Students Responded: <b><span id="totalStudents" style="font-size:1.2em">0</span></b></p>

      <div class="highlight" id="bestSlot">Best Slot: ‚Äî</div>
      <div class="highlight" id="bestDay">Best Day: ‚Äî</div>

    </div>

    <div class="right">
      <canvas id="freeTimeChart"></canvas>
    </div>

  </div>
</div>

<footer>
  <span>¬© Fall 25 GreedyMeet | Algorithm Lab Project | All rights reserved.</span> 
</footer>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbxlG57FNrAulG6SFlYp4m7BUG5BEaqgecY1lQR-0sRf8rfqjvK5L7meeDgiTgXh44duqQ/exec";

// Toggle Form Visibility
function toggleForm(){
  const form = document.getElementById('scheduleForm');
  form.style.display = form.style.display === "none" ? "block" : "none";
}

// Toggle Slots Dropdown
function toggleSlots(){
  const dropdown = document.getElementById('slotDropdown');
  dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
}

// Handle Off Day Checkbox
const offDay = document.getElementById('offDay');
const slotBox = document.getElementById('slotBox');
offDay.onchange = () => {
  slotBox.style.display = offDay.checked ? "none" : "block";
};

// Form Submission
document.getElementById('scheduleForm').onsubmit = (e) => {
  e.preventDefault();
  const slotDropdown = document.getElementById('slotDropdown');
  const slots = offDay.checked
    ? ["OFF"]
    : [...slotDropdown.querySelectorAll("input:checked")].map(x => x.value);

  // Simple validation
  if(!offDay.checked && slots.length === 0) {
    alert("Please select at least one time slot or mark as OFF day.");
    return;
  }

  const submitBtn = e.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = "Sending...";
  submitBtn.disabled = true;

  fetch(SCRIPT_URL,{
    method:"POST",
    body:JSON.stringify({
      studentID: document.getElementById('studentID').value,
      group: document.getElementById('group').value,
      day: document.getElementById('day').value,
      timeSlots: slots
    })
  }).then(() => {
    alert("Submitted Successfully ‚úÖ");
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
    toggleForm(); // Hide form after submit
  }).catch(err => {
    alert("Error submitting data.");
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
  });
};

// Chart Loading Logic
let chart;
function loadChart(){
  const dashboardGroup = document.getElementById('dashboardGroup');
  const daySelect = document.getElementById('daySelect');
  const loader = document.getElementById('loader');

  if(!dashboardGroup.value) {
    alert("Please enter a group name");
    return;
  }

  loader.style.display = "inline-block";

  fetch(`${SCRIPT_URL}?group=${dashboardGroup.value}`)
  .then(r => r.json())
  .then(data => {
    loader.style.display = "none";
    document.getElementById('totalStudents').textContent = data.totalStudents;

    // Handle case where group doesn't exist
    if(!data.freeTime || !data.freeTime[daySelect.value]) {
       alert("No data found for this group/day.");
       return;
    }

    const dayData = data.freeTime[daySelect.value];
    const labels = Object.keys(dayData);
    const values = Object.values(dayData);

    // Update Chart
    const ctx = document.getElementById('freeTimeChart').getContext("2d");
    const gradient = ctx.createLinearGradient(0,0,0,400);
    gradient.addColorStop(0, "#00ffe0");
    gradient.addColorStop(1, "#007f73");

    if(chart) chart.destroy();
    
    chart = new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "% Students Free",
          data: values,
          backgroundColor: gradient,
          borderColor: "#00ffc8",
          borderWidth: 1,
          borderRadius: 4,
          hoverBackgroundColor: "#fff"
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false, // Important for mobile sizing
        scales: {
          y: {
            beginAtZero: true,
            max: 100,
            grid: { color: "#00ffc822" },
            ticks: { color: "#00ffc8" }
          },
          x: {
            grid: { display: false },
            ticks: { color: "#00ffc8", autoSkip: false, maxRotation: 90, minRotation: 45 }
          }
        },
        plugins: {
          legend: { labels: { color: "#00ffc8" } }
        }
      }
    });

    // Calculate Insights
    let max = Math.max(...values);
    let slot = labels[values.indexOf(max)];
    document.getElementById('bestSlot').textContent = `Best Slot: ${slot} (${max}% free)`;

    let bestD = "", bestAvg = 0;
    for(const d in data.freeTime){
      let dayVals = Object.values(data.freeTime[d]);
      if(dayVals.length > 0) {
        let avg = dayVals.reduce((a,b)=>a+b,0) / dayVals.length;
        if(avg > bestAvg){ bestAvg = avg; bestD = d; }
      }
    }
    document.getElementById('bestDay').textContent = `Best Day Overall: ${bestD} (~${bestAvg.toFixed(1)}% free)`;
  })
  .catch(err => {
    loader.style.display = "none";
    console.error(err);
    alert("Failed to fetch data.");
  });
}
</script>

</body>
</html>
