<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>GreedyMeet</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ======= GLOBAL FUTURISTIC CYBER THEME ======= */
body {
    margin: 0;
    padding: 0;
    font-family: 'Courier New', monospace;
    background: #03040a;
    color: #00ffe0;
}

/* Floating neon bits */
@keyframes floatBits {
  from { transform: translateY(0); opacity: 0.8; }
  to { transform: translateY(-100vh); opacity: 0; }
}
.binary {
  position: fixed;
  bottom: -20px;
  font-size: 13px;
  color: rgba(0,255,200,0.18);
  animation: floatBits linear infinite;
  pointer-events: none;
}

/* Cyber Glass Cards */
form, .dashboard-section {
    background: rgba(0, 255, 200, 0.07);
    border: 1px solid #00ffc8;
    padding: 22px;
    border-radius: 16px;
    margin: 20px auto;
    max-width: 900px;
    box-shadow: 0 0 18px #00ffc825;
    backdrop-filter: blur(6px);
}

/* Inputs */
input, select {
    padding: 10px;
    margin: 8px;
    border-radius: 6px;
    border: 1px solid #00ffc8;
    background: #081616;
    color: #00ffe0;
    width: 260px;
}

button {
    background: #001a1a;
    color: #00ffe0;
    border: 1px solid #00ffc8;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
}
button:hover { background: #003737; }

/* Loader */
.loader {
    border: 3px solid #003c3c;
    border-top: 3px solid #00ffea;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    animation: spin 1s linear infinite;
    display: none;
}
@keyframes spin {100% {transform: rotate(360deg);}}

/* ---- DROPDOWN CHECKBOX MENU ---- */
.dropdown-box {
    margin: 10px 0;
}
.dropdown-btn {
    width: 260px;
    padding: 10px;
    background:#001a1a;
    color:#00ffe0;
    border:1px solid #00ffc8;
    border-radius:6px;
    cursor:pointer;
}
.dropdown-content {
    display:none;
    background:#081818;
    border:1px solid #00ffc8;
    border-radius:6px;
    padding:10px;
    margin-top:5px;
    max-height:250px;
    overflow-y:auto;
}
.dropdown-content label { display:block; padding:4px 0; }

/* Responsive */
@media(max-width:600px){
  input, select, .dropdown-btn { width:100%; }
}
</style>
</head>
<body>

<!-- FLOATING BINARY PARTICLES -->
<script>
for(let i=0;i<40;i++){
  let d=document.createElement("div");
  d.className="binary";
  d.style.left=Math.random()*100+"vw";
  d.style.animationDuration=(6+Math.random()*10)+"s";
  d.textContent=Math.random()>0.5?"0":"1";
  document.body.appendChild(d);
}
</script>

<h2 style="text-align:center;margin-top:30px;">Submit you class schedule</h2>

<form id="scheduleForm">
  <input type="text" id="studentID" placeholder="Student ID" required>
  <input type="text" id="group" placeholder="Group Name" required>

  <select id="day">
    <option>Saturday</option>
    <option>Sunday</option>
    <option>Monday</option>
    <option>Tuesday</option>
    <option>Wednesday</option>
    <option>Thursday</option>
    <option>Friday</option>
  </select>

  <h3>Select Your Time Slots</h3>

  <label><input type="checkbox" id="offDay"> This is my OFF Day</label><br><br>

  <!-- NEW DROPDOWN CHECKBOX -->
  <div class="dropdown-box">
    <button type="button" class="dropdown-btn" onclick="toggleSlots()">Select Time Slots ▼</button>
    <div class="dropdown-content" id="slotDropdown">
      <label><input type="checkbox" value="08:30–09:50"> 08:30–09:50</label>
      <label><input type="checkbox" value="08:00–10:00"> 08:00–10:00</label>
      <label><input type="checkbox" value="08:30–10:00"> 08:30–10:00</label>
      <label><input type="checkbox" value="09:00–10:00"> 09:00–10:00</label>
      <label><input type="checkbox" value="10:00–11:20"> 10:00–11:20</label>
      <label><input type="checkbox" value="10:00–12:00"> 10:00–12:00</label>
      <label><input type="checkbox" value="11:30–12:50"> 11:30–12:50</label>
      <label><input type="checkbox" value="11:30–13:30"> 11:30–13:30</label>
      <label><input type="checkbox" value="13:30–14:50"> 13:30–14:50</label>
      <label><input type="checkbox" value="13:30–15:30"> 13:30–15:30</label>
      <label><input type="checkbox" value="15:00–16:20"> 15:00–16:20</label>
      <label><input type="checkbox" value="15:00–17:00"> 15:00–17:00</label>
      <label><input type="checkbox" value="16:30–18:30"> 16:30–18:30</label>
      <label><input type="checkbox" value="16:30–17:50"> 16:30–17:50</label>
      <label><input type="checkbox" value="17:00–19:00"> 17:00–19:00</label>
    </div>
  </div>

  <button type="submit">Submit</button>
</form>

<div class="dashboard-section">
<h2>Group Free Time Dashboard</h2>

<input type="text" id="dashboardGroup" placeholder="Group Name" value="DefaultGroup">
<select id="daySelect">
  <option>Saturday</option>
  <option>Sunday</option>
  <option>Monday</option>
  <option>Tuesday</option>
  <option>Wednesday</option>
  <option>Thursday</option>
  <option>Friday</option>
</select>

<p>Total Students in Group: <span id="totalStudents">0</span></p>

<button id="refreshBtn">Refresh Chart</button>
<span class="loader" id="refreshLoader"></span>

<br><br>

<button id="bestDayBtn">Find Best Meeting Day</button>
<span class="loader" id="bestDayLoader"></span>

<p id="bestDayResult"></p>

<canvas id="freeTimeChart"></canvas>
<br>
<canvas id="bestDayPie"></canvas>

</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwS3seRQOGe5SEHUSiwkaP1kn66SZ836AKaVySZaR5vwinu2PwdHqNfEwTt07gPqtM9/exec";

/* ---- DROPDOWN FUNCTION ---- */
function toggleSlots(){
  const box = document.getElementById("slotDropdown");
  box.style.display = box.style.display === "block" ? "none" : "block";
}

/* ---- OFF DAY DISABLE ---- */
document.getElementById("offDay").addEventListener("change", function(){
  const dis = this.checked;
  document.querySelectorAll("#slotDropdown input").forEach(cb=>cb.disabled=dis);
});

/* ---- SUBMIT FORM ---- */
document.getElementById("scheduleForm").addEventListener("submit", e=>{
  e.preventDefault();

  const studentID = studentID.value;
  const group = group.value;
  const day = day.value;
  const offDay = offDay.checked;

  let timeSlots = [];

  if(offDay){
    timeSlots = ["OFF"];
  } else {
    timeSlots = Array.from(document.querySelectorAll("#slotDropdown input:checked"))
      .map(cb=>cb.value);
    if(!timeSlots.length) return alert("Select at least one time slot.");
  }

  fetch(SCRIPT_URL,{method:"POST",body:JSON.stringify({studentID,group,day,timeSlots})})
    .then(r=>r.json())
    .then(()=>alert("Schedule Submitted!"));
});

let chart, pie;

/* ---- LOAD BAR CHART ---- */
function loadChart(){
  document.getElementById("refreshLoader").style.display="inline-block";

  const group = dashboardGroup.value;
  const day = daySelect.value;

  fetch(`${SCRIPT_URL}?group=${group}`)
    .then(r=>r.json())
    .then(data=>{
      document.getElementById("refreshLoader").style.display="none";
      totalStudents.textContent = data.totalStudents;

      const slots = Object.keys(data.freeTime[day]);
      const values = Object.values(data.freeTime[day]);

      if(chart) chart.destroy();

      chart=new Chart(freeTimeChart,{
        type:"bar",
        data:{
          labels:slots,
          datasets:[{label:"Free %",data:values}]
        },
        options:{responsive:true,scales:{y:{beginAtZero:true,max:100}}}
      });
  });
}

/* ---- BEST DAY PIE CHART ---- */
document.getElementById("bestDayBtn").addEventListener("click",()=>{
  document.getElementById("bestDayLoader").style.display="inline-block";

  const group = dashboardGroup.value;

  fetch(`${SCRIPT_URL}?group=${group}`).then(r=>r.json()).then(data=>{
    document.getElementById("bestDayLoader").style.display="none";

    let labels=[], values=[];
    for(const d in data.freeTime){
      const arr = Object.values(data.freeTime[d]);
      labels.push(d);
      values.push(arr.reduce((a,b)=>a+b,0)/arr.length);
    }

    if(pie) pie.destroy();
    pie=new Chart(bestDayPie,{
      type:"pie",
      data:{
        labels:labels,
        datasets:[{data:values}]
      }
    });

    // Show best day text
    let maxVal=Math.max(...values);
    let bestDay=labels[values.indexOf(maxVal)];
    bestDayResult.textContent=`Best Day: ${bestDay} (${maxVal.toFixed(1)}% free)`;
  });
});


daySelect.onchange = loadChart;
dashboardGroup.oninput = loadChart;
refreshBtn.onclick = loadChart;

loadChart();
</script>

</body>
</html>
