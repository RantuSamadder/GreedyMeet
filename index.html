<!DOCTYPE html>
<html>
<head>
  <title>Student Free Time Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    canvas { max-width: 800px; }
  </style>
</head>
<body>
<h2>Group Free Time Dashboard</h2>
<select id="daySelect"></select>
<canvas id="freeChart"></canvas>

<script>
const webAppURL = 'https://script.google.com/macros/s/AKfycbxloi8--GBTRosRV5yLUSLHLVnBiUAEgqoR5Sx8-inoTrGF0-SMZPNuSK9HR1OHbOpltQ/exec';

async function fetchData() {
  const res = await fetch(webAppURL);
  const data = await res.json();
  return data;
}

function populateDays(days){
  const select = document.getElementById('daySelect');
  days.forEach(day=>{
    const opt = document.createElement('option');
    opt.value = day;
    opt.textContent = day;
    select.appendChild(opt);
  });
}

function drawChart(slots, freePercent){
  const ctx = document.getElementById('freeChart').getContext('2d');
  if(window.myChart) window.myChart.destroy();
  window.myChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: slots,
      datasets: [{
        label: '% Students Free',
        data: freePercent,
        backgroundColor: 'rgba(54, 162, 235, 0.6)'
      }]
    },
    options: { scales: { y: { beginAtZero:true, max:100 } } }
  });
}

async function init(){
  const data = await fetchData();
  const days = Object.keys(data.freeData);
  populateDays(days);
  drawChart(data.slots, data.freeData[days[0]]);

  document.getElementById('daySelect').addEventListener('change', (e)=>{
    drawChart(data.slots, data.freeData[e.target.value]);
  });
}

init();
</script>
</body>
</html>
